---
import Layout from "../../layouts/layout-base.astro";
import { DashboardLayout } from "@/components/page/dashboard/layout";

const { user } = Astro.locals;

if (!user) {
  return Astro.redirect("/signin");
}

if (user && !user.is_onboarded) {
  return Astro.redirect("/onboarding");
}
---

<Layout title="Dashboard - Hackerfolio">
  <!-- Loading skeleton shown during server-side rendering -->
  <div id="dashboard-skeleton" class="[--header-height:calc(--spacing(14))]">
    <div class="flex flex-col">
      <!-- Header skeleton -->
      <header class="flex h-(--header-height) shrink-0 items-center gap-2 border-b px-4">
        <div class="flex items-center gap-2">
          <div class="h-8 w-8 animate-pulse rounded-md bg-muted"></div>
          <div class="h-4 w-24 animate-pulse rounded-md bg-muted"></div>
        </div>
        <div class="ml-auto flex items-center gap-2">
          <div class="h-8 w-20 animate-pulse rounded-md bg-muted"></div>
          <div class="h-8 w-8 animate-pulse rounded-full bg-muted"></div>
        </div>
      </header>

      <!-- Main content area -->
      <div class="flex flex-1">
        <!-- Sidebar skeleton -->
        <aside class="flex h-[calc(100svh-var(--header-height))] w-64 flex-col border-r bg-muted/10">
          <div class="flex flex-col gap-2 p-4">
            <!-- Logo -->
            <div class="h-8 w-32 animate-pulse rounded-md bg-muted mb-4"></div>

            <!-- Navigation items -->
            <div class="space-y-2">
              <div class="h-4 w-full animate-pulse rounded-md bg-muted"></div>
              <div class="h-8 w-20 animate-pulse rounded-md bg-muted ml-4"></div>
              <div class="h-8 w-24 animate-pulse rounded-md bg-muted ml-4"></div>
            </div>

            <div class="space-y-2 mt-4">
              <div class="h-4 w-full animate-pulse rounded-md bg-muted"></div>
              <div class="h-8 w-16 animate-pulse rounded-md bg-muted ml-4"></div>
              <div class="h-8 w-20 animate-pulse rounded-md bg-muted ml-4"></div>
            </div>
          </div>

          <!-- Footer -->
          <div class="mt-auto p-4">
            <div class="h-8 w-20 animate-pulse rounded-md bg-muted"></div>
          </div>
        </aside>

        <!-- Content skeleton -->
        <main class="flex-1 p-12">
          <div class="flex flex-1 flex-col gap-6">
            <!-- Header skeleton -->
            <div class="space-y-3">
              <div class="h-9 w-48 animate-pulse rounded-md bg-muted"></div>
              <div class="h-5 w-96 animate-pulse rounded-md bg-muted"></div>
            </div>

            <!-- Content skeleton -->
            <div class="space-y-6">
              <!-- Bio sections skeleton -->
              <div class="space-y-4">
                <!-- Personal info section -->
                <div class="rounded-lg border p-6 space-y-4">
                  <div class="h-6 w-32 animate-pulse rounded-md bg-muted"></div>
                  <div class="grid grid-cols-2 gap-4">
                    <div class="h-10 animate-pulse rounded-md bg-muted"></div>
                    <div class="h-10 animate-pulse rounded-md bg-muted"></div>
                  </div>
                </div>

                <!-- Avatar section -->
                <div class="rounded-lg border p-6 space-y-4">
                  <div class="h-6 w-24 animate-pulse rounded-md bg-muted"></div>
                  <div class="flex items-center gap-4">
                    <div class="h-16 w-16 animate-pulse rounded-full bg-muted"></div>
                    <div class="space-y-2">
                      <div class="h-4 w-32 animate-pulse rounded-md bg-muted"></div>
                      <div class="h-9 w-40 animate-pulse rounded-md bg-muted"></div>
                    </div>
                  </div>
                </div>

                <!-- Social links section -->
                <div class="rounded-lg border p-6 space-y-4">
                  <div class="h-6 w-28 animate-pulse rounded-md bg-muted"></div>
                  <div class="grid grid-cols-2 gap-4">
                    <div class="h-10 animate-pulse rounded-md bg-muted"></div>
                    <div class="h-10 animate-pulse rounded-md bg-muted"></div>
                    <div class="h-10 animate-pulse rounded-md bg-muted"></div>
                    <div class="h-10 animate-pulse rounded-md bg-muted"></div>
                  </div>
                </div>

                <!-- Bio text section -->
                <div class="rounded-lg border p-6 space-y-4">
                  <div class="h-6 w-20 animate-pulse rounded-md bg-muted"></div>
                  <div class="h-24 w-full animate-pulse rounded-md bg-muted"></div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>

  <DashboardLayout user={user} client:only="react" />
</Layout>

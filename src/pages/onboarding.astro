---
import Layout from "../layouts/layout-base.astro";
import { Logo } from "@/components/ui/logo";
import { OnboardingSteps } from "@/components/page/onboarding/steps";

import { getCurrentSession, hasUsername, type SessionDisplay } from "@/lib/dal";

let sessionData: SessionDisplay | null = await getCurrentSession();

if (!sessionData) {
  throw new Error("Session data not found");
}

if (await hasUsername(sessionData.user.id)) {
  return Astro.redirect("/dashboard");
}
---

<style>
  .hero {
    --bg-url: url("../assets/bg-mobile.jpg");
    color: var(--primary-foreground);
    background-image: linear-gradient(-180deg, oklch(0.6499 0.1883 257.88 / 0) 75%, oklch(0.6499 0.1883 257.88 / 0.75)),
      linear-gradient(to bottom, oklch(0.2221 0 0 / 1) 50%, oklch(0.2221 0 0 / 0)), var(--bg-url);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    height: 100%;
    width: 100%;

    @media (min-width: 40rem) {
      --bg-url: url("../assets/bg.jpg");
      background-image: linear-gradient(
          -160deg,
          oklch(0.6499 0.1883 257.88 / 0) 50%,
          oklch(0.6499 0.1883 257.88 / 0.75)
        ),
        linear-gradient(to bottom, oklch(0.2221 0 0 / 0.95) 10%, oklch(0.2221 0 0 / 0)),
        linear-gradient(to bottom, oklch(0.2221 0 0 / 0.9) 40%, oklch(0.2221 0 0 / 0.5)), var(--bg-url);
    }
  }
</style>

<Layout title="Complete Your Profile">
  <div class="min-h-screen lg:grid lg:grid-cols-2">
    <div class="hero grid place-items-center">
      <div class="space-y-3">
        <Logo className="text-2xl sm:text-5xl" />
        <p class="text-background/86">
          Say <span class="font-mono">“</span>hello world<span class="font-mono">”</span> with us today!
        </p>
      </div>
    </div>
    <div class="p-24">
      <OnboardingSteps client:load />
    </div>
  </div>
</Layout>

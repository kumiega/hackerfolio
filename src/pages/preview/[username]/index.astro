---
import Layout from "@/layouts/layout-portfolio.astro";
import BioSection from "@/components/page/portfolio/bio.astro";
import SectionRenderer from "@/components/page/portfolio/section-renderer.astro";
import Footer from "@/components/page/portfolio/footer.astro";
import PixelBlast from "@/components/ui/pixel-blast";

import "@/styles/portfolio.css";

import { mockPortfolioData as data } from "@/lib/mock-data";

const socialLinks = data.bio
  .filter((component) => component.type === "social_links")
  .reduce(
    (links, component) => {
      const data = component.data as {
        github?: string;
        linkedin?: string;
        x?: string;
        website?: { name: string; url: string }[];
      };
      if (data.github) links.github = data.github;
      if (data.linkedin) links.linkedin = data.linkedin;
      if (data.x) links.twitter = data.x;
      if (data.website) {
        data.website.forEach((site) => {
          if (site.name?.toLowerCase().includes("blog")) {
            links.blog = site.url;
          }
        });
      }
      return links;
    },
    {} as Record<string, string>
  );

const bioText = data.bio
  .filter((component) => component.type === "text")
  .map((component) => (component.data as { content: string }).content)
  .join(" ");
---

<Layout title="Portfolio - Hackerfolio">
  <div class="max-w-[480px] mx-auto pt-24 px-5 relative z-[1]">
    <BioSection
      name={data.full_name}
      title={data.position}
      description={bioText}
      avatarSrc={data.avatar_url || "/images/avatar.jpg"}
      links={socialLinks}
    />

    <main>
      <SectionRenderer sections={data.sections} />
    </main>
  </div>
  <div class="absolute top-0 left-0 h-[33vh] w-full">
    <PixelBlast client:load color="#E5E5E5" />
  </div>
  <Footer copyrightYear="2025" copyrightText="© All rights reserved." madeWithText="» Made with" madeWithUrl="/" />
</Layout>

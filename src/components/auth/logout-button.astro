---
import { Button } from "@/components/ui/button";
import { AuthService } from "@/lib/services/auth.service";

// Server-side authentication check
let isAuthenticated = false;
try {
  await AuthService.getCurrentSession(Astro.locals.supabase);
  isAuthenticated = true;
} catch (error) {
  isAuthenticated = false;
}

interface LogoutButtonProps {
  variant?: "default" | "light" | "glass" | "dark" | "destructive" | "outline" | "secondary" | "ghost" | "link";
  size?: "default" | "sm" | "lg" | "icon" | "icon-sm" | "icon-lg";
  className?: string;
  children?: string;
}

const {
  variant = "ghost",
  size = "default",
  className,
  children = "Logout"
} = Astro.props as LogoutButtonProps;
---

{
  isAuthenticated && (
    <form method="POST" action="/api/v1/auth/logout" class="inline">
      <Button
        variant={variant}
        size={size}
        className={className}
        type="submit"
        aria-label="Logout from your account"
      >
        {children}
      </Button>
    </form>
  )
}

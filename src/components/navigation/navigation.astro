---
import { Button } from "@/components/ui/button";
import { Logo } from "@/components/ui/logo";
import { AuthService } from "@/lib/services/auth.service";
import type { AuthSessionDto } from "@/types";

// Get authentication state server-side
let sessionData: AuthSessionDto | null = null;
let isAuthenticated = false;
let userEmail = "";

try {
  sessionData = await AuthService.getCurrentSession();
  isAuthenticated = true;
  userEmail = sessionData.user.email;
} catch (error) {
  console.error("Error getting current session:", error);
  isAuthenticated = false;
}
---

<nav class="py-6 sm:py-12 flex justify-between items-center">
  <Logo />

  <div class="flex items-center space-x-4">
    {
      isAuthenticated ? (
        <>
          <span class="text-sm text-muted-foreground hidden sm:inline">Welcome, {userEmail}</span>
          <Button variant="glass" href="/dashboard">
            Dashboard
          </Button>
          <form method="POST" action="/api/v1/auth/logout" class="inline">
            <Button variant="ghost" type="submit" aria-label="Logout from your account">
              Logout
            </Button>
          </form>
        </>
      ) : (
        <>
          <Button variant="glass" href="/login">
            Log in
          </Button>
        </>
      )
    }
  </div>
</nav>
